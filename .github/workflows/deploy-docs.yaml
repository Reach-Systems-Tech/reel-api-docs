name: Deploy Documentation

on:
  # Triggered when docs are pushed from private repo
  repository_dispatch:
    types: [deploy-docs]

  # Manual trigger for testing
  workflow_dispatch:
    inputs:
      docs_url:
        description: "URL to download docs from (optional for testing)"
        required: false
        type: string

permissions:
  contents: write
  pages: write
  id-token: write

# Allow only one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download documentation artifacts
        run: |
          # Create docs directory
          mkdir -p docs

          # The docs will be sent via the repository_dispatch payload
          # For now, create a placeholder structure
          echo "# API Documentation" > docs/index.html
          echo "<p>Documentation will be deployed here automatically from the private repository.</p>" >> docs/index.html

          # If this is a manual trigger with docs_url, download from there
          if [ -n "${{ github.event.inputs.docs_url }}" ]; then
            echo "ðŸ“¥ Downloading docs from provided URL..."
            curl -L "${{ github.event.inputs.docs_url }}" -o docs.zip
            unzip docs.zip -d docs/
          fi

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./docs

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: Deployment summary
        run: |
          echo "âœ… Documentation deployed successfully!"
          echo "ðŸ“– URL: ${{ steps.deployment.outputs.page_url }}"
          echo "ðŸ”— Repository: ${{ github.repository }}"
